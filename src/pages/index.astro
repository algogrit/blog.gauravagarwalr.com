---
import { getCollection } from 'astro:content';

import Hero from '../components/sections/Hero.astro';
import About from '../components/sections/About';
import Base from '../layouts/Base.astro';
import HomeNewsletter from '../components/cta/HomeNewsletter';

import addReadingTime from '../data/posts/addReadingTime';
import FeaturedPost from '../components/posts/FeaturedPost';
import LatestPosts from '../components/posts/LatestPosts';
import TagNav from '../components/tags/TagNav';

const posts = addReadingTime(await getCollection("posts"));
const featuredPost = posts.find((post) => post.data.featured);

const tagCounts = posts
.flatMap(post => post.data.tags)
.reduce((acc: any, tag: string) => {
	acc[tag] = (acc[tag] || 0) + 1;
	return acc;
}, {});

const allTags = Object.entries(tagCounts)
	.sort((a, b) => b[1] - a[1])
	.map(([tag]) => tag);

---

<Base>
	<Hero/>
	<FeaturedPost post={featuredPost}/>
	<TagNav tags={allTags}/>
	<LatestPosts posts={posts} />
	<HomeNewsletter/>
	<About/>
</Base>
