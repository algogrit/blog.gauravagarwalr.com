---
import { getCollection } from 'astro:content';

import Hero from '../components/sections/Hero.astro';
import HomePosts from '../components/sections/HomePosts';
import About from '../components/sections/About';
import Base from '../layouts/Base.astro';
import HomeNewsletter from '../components/cta/HomeNewsletter';

import addReadingTime from '../data/posts/addReadingTime';
import FeaturedPost from '../components/posts/FeaturedPost';

const posts = addReadingTime(await getCollection("posts"));
const featuredPost = posts.find((post) => post.data.featured);

const tagCounts = posts
	.flatMap(post => post.data.tags)
	.reduce((acc: any, tag: string) => {
		acc[tag] = (acc[tag] || 0) + 1;
		return acc;
	}, {});

const allTags = Object.entries(tagCounts)
	.sort((a, b) => b[1] - a[1])
	.map(([tag]) => tag);

---

<Base>
	<Hero/>
	<FeaturedPost post={featuredPost}/>
	<HomePosts posts={posts} tags={allTags} client:only/>
	<HomeNewsletter/>
	<About/>
</Base>
